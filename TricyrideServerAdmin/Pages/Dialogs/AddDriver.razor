@inject ISnackbar Snackbar

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.Add" Class="mr-3 mb-n1"/>
            ADD
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudStepper NonLinear @bind-ActiveIndex="_index">
            <ChildContent>
                <MudStep Title="Driver's Profile">
                    <MudGrid Spacing="3">
                        <MudItem xs="2"></MudItem>
                        <MudItem xs="8">
                            Driver's Information
                            <MudDivider></MudDivider>
                        </MudItem>
                        <MudItem xs="2"></MudItem>

                        <MudItem xs="2"></MudItem>
                        <MudItem xs="4">
                            <MudTextField @bind-Value="UserAccount.firstname" Margin="Margin.Dense" Variant="Variant.Outlined" Label="First name" ShrinkLabel></MudTextField>
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField @bind-Value="UserAccount.lastname" Margin="Margin.Dense" Variant="Variant.Outlined" Label="Last name" ShrinkLabel></MudTextField>
                        </MudItem>
                        <MudItem xs="2"></MudItem>

                        <MudItem xs="2"></MudItem>
                        <MudItem xs="4">
                            <MudTextField @bind-Value="UserAccount.address" Margin="Margin.Dense" Variant="Variant.Outlined" Label="Address" ShrinkLabel></MudTextField>
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField @bind-Value="UserAccount.phoneNumber" Margin="Margin.Dense" Variant="Variant.Outlined" Label="Contact Number" ShrinkLabel></MudTextField>
                        </MudItem>
                        <MudItem xs="2"></MudItem>
                        
                        <MudItem xs="2"></MudItem>
                        <MudItem xs="4">
                            <MudTextField @bind-Value="UserAccount.email" Margin="Margin.Dense" Variant="Variant.Outlined" Label="Email" Disabled="@(!String.IsNullOrEmpty(UserAccount.uid))" ShrinkLabel></MudTextField>
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField @bind-Value="UserAccount.username" Margin="Margin.Dense" Variant="Variant.Outlined" Label="Username" Disabled="@(!String.IsNullOrEmpty(UserAccount.uid))" ShrinkLabel></MudTextField>
                        </MudItem>
                        <MudItem xs="2"></MudItem>
                        <MudItem xs="2"></MudItem>
                        <MudItem xs="4">
                            <MudTextField @bind-Value="UserAccount.password" InputType="PasswordInput" Label="Password" Variant="Variant.Outlined" Margin="Margin.Dense" Disabled="@(!String.IsNullOrEmpty(UserAccount.uid))"
                                            Adornment="Adornment.End" AdornmentIcon="@PasswordInputIcon" OnAdornmentClick="ButtonTestclick" AdornmentAriaLabel="Show password"/>
                        </MudItem>
                        <MudItem xs="4">
                            <MudTextField @bind-Value="cpassword" Margin="Margin.Dense" Variant="Variant.Outlined" InputType="InputType.Password" Label="Confirm Password" Disabled="@(!String.IsNullOrEmpty(UserAccount.uid))" ShrinkLabel></MudTextField>
                        </MudItem>
                        <MudItem xs="2"></MudItem>
                    </MudGrid>
                </MudStep>
                <MudStep Title="Documents">
                    <MudGrid Spacing="3">
                        <MudItem xs="2"></MudItem>
                        <MudItem xs="8">
                            Document Check List
                            <MudDivider></MudDivider>
                        </MudItem>
                        <MudItem xs="2"></MudItem>

                        <MudItem xs="2"></MudItem>
                        <MudItem xs="3">
                            <MudCheckBox Class="mt-2" @bind-Value="DriverDocument.isValidID" Color="Color.Primary" Dense>Valid ID</MudCheckBox>
                        </MudItem>
                        <MudItem xs="5">
                            <MudTextField @bind-Value="DriverDocument.ValidID" Margin="Margin.Dense" Variant="Variant.Text" Label="Type" ShrinkLabel Disabled="!DriverDocument.isValidID"></MudTextField>
                        </MudItem>
                        <MudItem xs="2"></MudItem>
                        <MudItem xs="2"></MudItem>
                        <MudItem xs="3">
                            <MudCheckBox Class="mt-2" @bind-Value="DriverDocument.isORCR" Color="Color.Primary" Dense>OR/CR</MudCheckBox>
                        </MudItem>
                        <MudItem xs="5">
                            <MudTextField @bind-Value="DriverDocument.ORCR" Margin="Margin.Dense" Variant="Variant.Text" Label="Type" ShrinkLabel Disabled="!DriverDocument.isORCR"></MudTextField>
                        </MudItem>
                        <MudItem xs="2"></MudItem>

                        <MudItem xs="2"></MudItem>
                        <MudItem xs="3">
                            <MudCheckBox Class="mt-2" @bind-Value="DriverDocument.isDriverLicense" Color="Color.Primary" Dense>Driver License</MudCheckBox>
                        </MudItem>
                        <MudItem xs="5">
                            <MudDatePicker Label="Expiration" @bind-Date="DriverDocument.DriverLicenseExpiry" Margin="Margin.Dense" Disabled="!DriverDocument.isDriverLicense"></MudDatePicker>
                        </MudItem>
                        <MudItem xs="2"></MudItem>

                        <MudItem xs="2"></MudItem>
                        <MudItem xs="3">
                            <MudCheckBox Class="mt-2" @bind-Value="DriverDocument.isInsurance" Color="Color.Primary" Dense>Insurance Policy</MudCheckBox>
                        </MudItem>
                        <MudItem xs="5">
                            <MudDatePicker Label="Expiration" @bind-Date="DriverDocument.InsuranceExpiry" Margin="Margin.Dense" Disabled="!DriverDocument.isInsurance"></MudDatePicker>
                        </MudItem>
                        <MudItem xs="2"></MudItem>
                        <MudItem xs="2"></MudItem>
                        <MudItem xs="8">
                            Vehicle Information (if Applicable)
                            <MudDivider></MudDivider>
                        </MudItem>
                        <MudItem xs="2"></MudItem>
                        
                        <MudItem xs="2"></MudItem>
                        <MudItem xs="8">
                            <MudTextField @bind-Value="DriverDocument.LicenseNo" Margin="Margin.Dense" Variant="Variant.Text" Label="License No./Plate No." ShrinkLabel ></MudTextField>
                        </MudItem>
                        <MudItem xs="2"></MudItem>
                        
                        <MudItem xs="2"></MudItem>
                        <MudItem xs="8">
                            <MudTextField @bind-Value="DriverDocument.Owner" Margin="Margin.Dense" Variant="Variant.Text" Label="Owner" ShrinkLabel ></MudTextField>
                        </MudItem>
                        <MudItem xs="2"></MudItem>
                    </MudGrid>
                </MudStep>
                </ChildContent>
            <ActionContent Context="stepper"></ActionContent>
        </MudStepper>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
        <MudButton Color="Color.Error" OnClick="OnComplete">@(_index == 0 ? "Next" : "Save")</MudButton>
    </DialogActions>
</MudDialog>
@code {
    [CascadingParameter] private MudDialogInstance MudDialog { get; set; }
    [Parameter] public UserAccountModel UserAccount { get; set; }
    private void Cancel() => MudDialog.Cancel();
    
    private DriverDocumentModel DriverDocument = new();
    string cpassword = string.Empty;
    InputType PasswordInput = InputType.Password;
    string PasswordInputIcon = Icons.Material.Filled.VisibilityOff;
    bool isShow;
    private int _index;
    protected override async Task OnInitializedAsync() {
        if(!String.IsNullOrEmpty(UserAccount.uid)) {
            DriverDocument = await _accountService.GetDocumentByKey(UserAccount.uid);
            StateHasChanged();
        }
    }
    void ButtonTestclick()
    {
        @if (isShow)
        {
            isShow = false;
            PasswordInputIcon = Icons.Material.Filled.VisibilityOff;
            PasswordInput = InputType.Password;
        }
        else {
            isShow = true;
            PasswordInputIcon = Icons.Material.Filled.Visibility;
            PasswordInput = InputType.Text;
        }
    }
    private void Add()
    {
        MudDialog.Close();
    }
    private async Task OnComplete() {
        if(_index == 0)
        {
            _index = 1;
            StateHasChanged();
            return;
        }

        if(String.IsNullOrEmpty(UserAccount.password) || String.IsNullOrEmpty(UserAccount.email))
        {
            Extensions.ShowSnackbar("All fields are required.", Variant.Filled, _snackBar, Severity.Error);
            return;
        }
        if(UserAccount.password != cpassword)
        {
            Extensions.ShowSnackbar("Password did not match.", Variant.Filled, _snackBar, Severity.Error);
            return;
        }
        UserAccountResponse save = await _accountService.CreateUserWithEmailAndPassword(UserAccount.email, UserAccount.password);
        UserAccount.accountType = "Driver";
        UserAccount.uid = save.LocalId;
        await _accountService.UpdateUser(UserAccount);
        DriverDocument.key = save.LocalId;
        await _accountService.AddDocumentCheckList(DriverDocument);
        Extensions.ShowSnackbar("Driver successfully saved.", Variant.Filled, _snackBar, Severity.Success);
        MudDialog.Close();
    }
}
<style>
    .mud-dialog-title {
        padding: 10px !important;
        background-color: rgba(89,74,226,1);
        color: white !important;
    }
    .mud-dialog-title .mud-icon-root.mud-svg-icon {
        margin-top: -10px;
    }
    .mud-stepper {
        display: flex;
        justify-content: center;
        flex-direction: column;
        align-items: center;
    }
    .mud-stepper-nav {
        width: 70%;
    }
    .mud-stepper-nav-connector-line {
        margin-left: 20px;
        margin-right: 20px;
    }
</style>


